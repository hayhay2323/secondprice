(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[888],{1118:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return r(8397)}])},6266:function(e,t,r){"use strict";r.d(t,{H:function(){return AuthProvider},a:function(){return useAuth}});var a=r(5893),n=r(7294),s=r(1163);let o=(0,n.createContext)();function useAuth(){return(0,n.useContext)(o)}function AuthProvider(e){let{children:t}=e,[r,i]=(0,n.useState)(null),[u,l]=(0,n.useState)(!0);(0,s.useRouter)();let delay=e=>new Promise(t=>setTimeout(t,e));(0,n.useEffect)(()=>{let checkLoggedIn=async()=>{try{let e=localStorage.getItem("user");e&&i(JSON.parse(e))}catch(e){console.error("Failed to restore authentication state:",e)}finally{l(!1)}};checkLoggedIn()},[]);let register=async(e,t,r)=>{await delay(1e3);let a=JSON.parse(localStorage.getItem("users")||"[]");if(a.some(e=>e.email===t))throw Error("該電子郵件已被使用");let n={id:Date.now().toString(),name:e,email:t,createdAt:new Date().toISOString()};return a.push({...n,password:r}),localStorage.setItem("users",JSON.stringify(a)),i(n),localStorage.setItem("user",JSON.stringify(n)),n},login=async(e,t)=>{await delay(1e3);let r=JSON.parse(localStorage.getItem("users")||"[]"),a=r.find(r=>r.email===e&&r.password===t);if(!a)throw Error("電子郵件或密碼錯誤");let{password:n,...s}=a;return i(s),localStorage.setItem("user",JSON.stringify(s)),s},logout=async()=>{await delay(500),localStorage.removeItem("user"),i(null)},updateUserProfile=async e=>{if(await delay(1e3),!r)throw Error("用戶未登入");let t={...r,...e,updatedAt:new Date().toISOString()},a=JSON.parse(localStorage.getItem("users")||"[]"),n=a.map(t=>t.id===r.id?{...t,...e,updatedAt:new Date().toISOString()}:t);return localStorage.setItem("users",JSON.stringify(n)),i(t),localStorage.setItem("user",JSON.stringify(t)),t},resetPassword=async e=>{await delay(1e3);let t=JSON.parse(localStorage.getItem("users")||"[]"),r=t.find(t=>t.email===e);if(!r)throw Error("找不到該電子郵件的帳戶");return{success:!0,message:"密碼重置鏈接已發送到您的電子郵件"}};return(0,a.jsx)(o.Provider,{value:{currentUser:r,loading:u,register,login,logout,updateUserProfile,resetPassword},children:!u&&t})}},8397:function(e,t,r){"use strict";r.r(t);var a=r(5893);r(2352);var n=r(7294),s=r(1163),o=r(9008),i=r.n(o),u=r(6266);function RouteGuard(e){let{children:t}=e,{currentUser:r,loading:o}=(0,u.a)(),i=(0,s.useRouter)();return((0,n.useEffect)(()=>{!o&&"/login"!==i.pathname&&"/register"!==i.pathname&&"/"!==i.pathname&&"/forgot-password"!==i.pathname&&["/profile","/dashboard","/favorites","/settings","/orders"].includes(i.pathname)&&!r&&i.push({pathname:"/login",query:{redirect:i.pathname}})},[r,o,i]),o)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-12 h-12 border-t-4 border-primary-500 border-solid rounded-full animate-spin"})}):t}t.default=function(e){let{Component:t,pageProps:r}=e;return(0,a.jsxs)(u.H,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"}),(0,a.jsx)("title",{children:"SecondPrice.hk - 香港二手商品比價平台"}),(0,a.jsx)("meta",{name:"description",content:"SecondPrice.hk 匯集香港各大二手平台商品，智能比價，讓您輕鬆找到最划算的二手寶貝，同時響應可持續發展。"})]}),(0,a.jsx)(RouteGuard,{children:(0,a.jsx)(t,{...r})})]})}},2352:function(){},9008:function(e,t,r){e.exports=r(9201)},1163:function(e,t,r){e.exports=r(9974)}},function(e){var __webpack_exec__=function(t){return e(e.s=t)};e.O(0,[774,179],function(){return __webpack_exec__(1118),__webpack_exec__(9974)}),_N_E=e.O()}]);